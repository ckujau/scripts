#
# ~/.shell.local
#

# A more colourful prompt
export PS1='\[\033[1;31m\]\h#\[\033[0m\] '

# W3C Tidy
alias tidy="tidy -config $HOME/.tidyrc"

# Combine pwgen & passwdqc
pwgen_check() { pwgen $@ | pwqcheck -1 --multi; }

# dmesg filter to omit printk timestamps (if dmesg -t is not available yet)
npk() { sed 's/^\[[ 0-9\.]*\] //'; }

##### MacOS X
if [ -d /opt/local/bin ]; then
	export PATH=/opt/local/sbin:/opt/local/bin:$PATH
fi

# On MacOS X, TMPDIR changes every time Terminal.app starts
export SCREENDIR=$HOME/.screen

# More MacOS X shortcuts
alias top="top -o cpu"
alias df="df -P"
alias shuf="perl -MList::Util=shuffle -e 'print shuffle(<STDIN>);'"

# Android SDK
# alias      adb="/Applications/Non-Apple/AndroidSDK/sdk/platform-tools/adb"
# alias fastboot="/Applications/Non-Apple/AndroidSDK/sdk/platform-tools/fastboot"

# Enable "Secure Keyboard" for MacOS X
# https://security.stackexchange.com/questions/47749/how-secure-is-secure-keyboard-entry-in-mac-os-xs-terminal
# https://developer.apple.com/library/mac/technotes/tn2150/
defaults write com.apple.Terminal SecureKeyboardEntry 1

# https://gist.github.com/648188
function pwdx {
        lsof -a -p $1 -d cwd -n | tail -1 | awk '{print $NF}'
}

# Look for running SSH agents
SSH_AGENT_PID_TEMP=$(pgrep -u $LOGNAME ssh-agent | head -1)
if [ -n "$SSH_AGENT_PID_TEMP" ]; then
	SSH_AUTH_SOCK_TEMP=$(find /tmp/ssh-* -name "agent.*$((SSH_AGENT_PID_TEMP-1))" -user $LOGNAME -type s 2>/dev/null)
	if [ -S "$SSH_AUTH_SOCK_TEMP" ]; then
		export SSH_AGENT_PID="$SSH_AGENT_PID_TEMP"
		export SSH_AUTH_SOCK="$SSH_AUTH_SOCK_TEMP"
		unset SSH_AGENT_PID_TEMP SSH_AUTH_SOCK_TEMP
	fi
fi

# dmesg: translate relative printk time stamps to absolute time stamps
alias kmsg='dmesg | perl -ne "BEGIN{\$a= time()- qx!cat /proc/uptime!}; s/\[\s*(\d+)\.\d+\]/localtime(\$1 + \$a)/e; print \$_;"'
